---

title: Pipetography

keywords: fastai
sidebar: home_sidebar

summary: "Nipype and mrtrix3 based pre-/post- processing pipeline for brain diffusion-MRI and generation of structural connectomes of the brain."
description: "Nipype and mrtrix3 based pre-/post- processing pipeline for brain diffusion-MRI and generation of structural connectomes of the brain."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="https://github.com/axiezai/pipetography/workflows/CI/badge.svg" alt="CI">
<img src="https://img.shields.io/docker/v/axiezai/pipetography" alt="docker"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This repo currently only has pre-processing capabilities! More will be added in the near future.</p>
<p>The pre-processing workflow has been updated to reflect what's seen in the optimal <a href="http://www.sciencedirect.com/science/article/pii/S1053811918306827">DESIGNER pipeline</a> and on <a href="https://brainlife.io">mrtrix3 cloud apps on brainlife.io</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since most usages will be on HPC resources, I <em>highly recommend</em> that you use the <code>Singularity</code> or <code>Docker</code> recipe in the repository instead of installing the Python module.</p>
<h4 id="Singularity:">Singularity:<a class="anchor-link" href="#Singularity:"> </a></h4><ul>
<li><p>Currently has pathing issues as seen in the singularity issues page: <a href="https://github.com/hpcng/singularity/issues/5040">https://github.com/hpcng/singularity/issues/5040</a>, the 3.6 release candidate should fix this... For now, use docker image if you can. If not, the singularity container will not be able to execute freesurfer <code>recon-all</code> step of the workflow. All DWI preprocessing steps will work though.</p>
</li>
<li><p>This is a large image, you will need to set the following environment variables to somewhere other than <code>/tmp</code>:</p>
<ul>
<li><code>export SINGULARITY_TMPDIR={YOUR DESTINATION DIR}</code></li>
<li><code>export SINGULARITY_LOCALCACHEDIR={YOUR DESTINATION DIR}</code></li>
<li><code>export SINGULARITY_CACHEDIR={YOUR DESTINATION DIR}</code></li>
<li><code>export SINGULARITY_PULLFOLDER={YOUR DESTINATION DIR}</code></li>
</ul>
</li>
<li><p>Obtain the singularity image with <code>singularity pull docker://axiezai/pipetography:0.3.1</code>.</p>
</li>
<li><p>Run interactively with <code>singularity shell --nv --B &lt;BIDS_DIR&gt;:&lt;SINGULARITY_BIDS_DIR&gt; {Path to singularity .sif}</code></p>
</li>
</ul>
<h4 id="Docker:">Docker:<a class="anchor-link" href="#Docker:"> </a></h4><ul>
<li><p>Pull the docker image: <code>docker pull axiezai/pipetography:0.3.1</code></p>
</li>
<li><p>Run with BIDS directory and interactive bash terminal: <code>docker run -v &lt;BIDS_DIR&gt;:&lt;Docker_BIDS_DIR&gt; -it axiezai/pipetography:0.3.1 bash</code></p>
</li>
</ul>
<p>Known container issues:</p>
<ul>
<li><p>Singularity image missing freesurfer path to <code>nu_correct</code> as part of <code>$PATH</code>.</p>
</li>
<li><p>If <code>singularity build</code> fails with <code>apt-get install</code> error complaining about unauthenticated packages, add <code>--allow-unauthenticated</code> to every <code>apt-get</code> line in the <code>sinngularity.def</code> file.</p>
</li>
</ul>
<h4 id="Creating-your-own-environment-and-install-pipetography-as-a-Python-module:">Creating your own environment and install <code>pipetography</code> as a Python module:<a class="anchor-link" href="#Creating-your-own-environment-and-install-pipetography-as-a-Python-module:"> </a></h4><p><code>pip install pipetography</code></p>
<p>Since <code>pipetography</code> is a <code>Nipype</code> wrapper around <code>mrtrix3</code>, <code>ANTs</code>, and <code>FSL</code>, you have to follow their installation instructions and set them up appropriately on your machine as well:</p>
<ul>
<li><p><a href="https://mrtrix.readthedocs.io/en/latest/installation/before_install.html">mrtrix3 v3.0.0</a></p>
</li>
<li><p><a href="https://github.com/ANTsX/ANTs/wiki/Compiling-ANTs-on-Linux-and-Mac-OS">ANTs</a></p>
</li>
<li><p><a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FslInstallation">FSL</a></p>
</li>
<li><p><a href="https://surfer.nmr.mgh.harvard.edu/fswiki/DownloadAndInstall">Freesurfer v6.0</a></p>
</li>
<li><p><a href="https://surfer.nmr.mgh.harvard.edu/fswiki/MatlabRuntime">Matlab Run Time Compiler for freesurfer</a></p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-pipeline:">The pipeline:<a class="anchor-link" href="#The-pipeline:"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Currently supports acquisitions with no reverse phase encoding (<code>-rpe_none</code>)  and reverse phase encoding in all DWI directions (<code>-rpe_all</code>) options.</p>

</div>
</div>
</div>
</div>
 

