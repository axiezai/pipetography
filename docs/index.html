---

title: Pipetography


keywords: fastai
sidebar: home_sidebar

summary: "Nipype and mrtrix3 based pre-/post- processing pipeline for brain diffusion-MRI and generation of structural connectomes of the brain."
description: "Nipype and mrtrix3 based pre-/post- processing pipeline for brain diffusion-MRI and generation of structural connectomes of the brain."
nb_path: "index.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="https://github.com/axiezai/pipetography/workflows/CI/badge.svg" alt="CI">
<img src="https://img.shields.io/docker/v/axiezai/pipetography" alt="docker"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>The pre-processing pipeline has been updated to reflect what's seen in the optimal <a href="http://www.sciencedirect.com/science/article/pii/S1053811918306827">DESIGNER pipeline</a> and on <a href="https://brainlife.io">mrtrix3 cloud apps on brainlife.io</a>.</p>
<p>The post-processing pipeline, including co-registration of atlases and connectome generation is now included in the <a href="https://axiezai.github.io/pipetography/connectomes.html">connectomes</a> module</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since most usages will be on HPC resources, I <em>highly recommend</em> that you use the <code>Singularity</code> definition file in the repository instead of installing the Python module.</p>
<h3 id="Singularity:">Singularity:<a class="anchor-link" href="#Singularity:"> </a></h3><ul>
<li><p>This is a large image, you will need to set the following environment variables to somewhere other than <code>/tmp</code> if you want to avoid memory errors:</p>
<ul>
<li><code>export SINGULARITY_TMPDIR={YOUR DESTINATION DIR}</code></li>
<li><code>export SINGULARITY_LOCALCACHEDIR={YOUR DESTINATION DIR}</code></li>
<li><code>export SINGULARITY_CACHEDIR={YOUR DESTINATION DIR}</code></li>
<li><code>export SINGULARITY_PULLFOLDER={YOUR DESTINATION DIR}</code></li>
</ul>
</li>
<li><p>Build the singularity image with the <code>singularity.def</code> file provided in Github, you will need to have <code>sudo</code> permissions to perform singularity build. If you run into memory problems, consider building as a sandbox at first with the <code>-s</code> flag.</p>
<ul>
<li><code>sudo singularity build {image_file_name}.sif singularity.def</code></li>
</ul>
</li>
<li><p>OR pull the built singularity image from cloud library:</p>
<ul>
<li><code>singularity pull --arch amd64 library://axiezai/pipetography/pipetography-fsl6.0.3:latest</code></li>
</ul>
</li>
</ul>
<h3 id="Docker:">Docker:<a class="anchor-link" href="#Docker:"> </a></h3><ul>
<li>Docker often encounters permission problems on HPC resources, using the docker container is only recommended if you have <code>sudo</code> permissions to the machine. </li>
<li><code>docker pull axiezai/pipetography:0.3.9</code></li>
</ul>
<h3 id="Usage:">Usage:<a class="anchor-link" href="#Usage:"> </a></h3><ul>
<li>To run the singularity container interactively, you will need a few flags:<ul>
<li><code>-e</code> flag for a clean environnment upon container start</li>
<li><code>-B</code> flag to bind your BIDS directory into the container.</li>
</ul>
</li>
<li>Example: <ul>
<li><code>singularity shell -e -B &lt;BIDS_DIR&gt;:&lt;SINGULARITY_BIDS_DIR&gt; {Path to singularity .sif}</code> will start an interactive shell.</li>
<li><code>singualrity exec -e -B &lt;BIDS_DIR&gt;:&lt;SINGULARITY_BIDS_DIR&gt; {Path to singularity .sif} python dwi_pipeline.py</code> will execute the input python code. See <a href="https://axiezai.github.io/pipetography/pipeline.html">pipeline</a> for an example.</li>
</ul>
</li>
</ul>
<h3 id="Creating-your-own-environment-and-install-pipetography-as-a-Python-module:">Creating your own environment and install <code>pipetography</code> as a Python module:<a class="anchor-link" href="#Creating-your-own-environment-and-install-pipetography-as-a-Python-module:"> </a></h3><p><code>pip install pipetography</code></p>
<p>Since <code>pipetography</code> is a <code>Nipype</code> wrapper around <code>mrtrix3</code>, <code>ANTs</code>, and <code>FSL</code>, you have to follow their installation instructions and set them up appropriately on your machine as well:</p>
<ul>
<li><p><a href="https://mrtrix.readthedocs.io/en/latest/installation/before_install.html">mrtrix3 v3.0.0</a></p>
</li>
<li><p><a href="https://github.com/ANTsX/ANTs/wiki/Compiling-ANTs-on-Linux-and-Mac-OS">ANTs</a></p>
</li>
<li><p><a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FslInstallation">FSL</a></p>
</li>
</ul>
<p>Everything listed in this section is included in the Singularity and Docker containers.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-pipeline:">The pipeline:<a class="anchor-link" href="#The-pipeline:"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Currently supports acquisitions with no reverse phase encoding (<code>-rpe_none</code>)  and reverse phase encoding in all DWI directions (<code>-rpe_all</code>) options. See <a href="https://axiezai.github.io/pipetography/pipeline.html">pipeline</a> for preprocessing details, and <a href="https://axiezai.github.io/pipetography/connectomes.html">connectomes</a> for postprocessing details.</p>

</div>
</div>
</div>
</div>
 

