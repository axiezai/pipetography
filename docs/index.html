---

title: Pipetography

keywords: fastai
sidebar: home_sidebar

summary: "Nipype and mrtrix3 based pre-/post- processing pipeline for brain diffusion-MRI and generation of structural connectomes of the brain."
description: "Nipype and mrtrix3 based pre-/post- processing pipeline for brain diffusion-MRI and generation of structural connectomes of the brain."
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: index.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><img src="https://github.com/axiezai/pipetography/workflows/CI/badge.svg" alt="CI">
<img src="https://img.shields.io/docker/v/axiezai/pipetography" alt="docker"></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>This repo currently only has pre-processing capabilities! More will be added in the near future.</p>
<p>The pre-processing workflow has been updated to reflect what's seen in the optimal <a href="http://www.sciencedirect.com/science/article/pii/S1053811918306827">DESIGNER pipeline</a> and on <a href="https://brainlife.io">mrtrix3 cloud apps on brainlife.io</a>.</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Install">Install<a class="anchor-link" href="#Install"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Since most usages will be on HPC resources, I <em>highly recommend</em> that you use the <code>Singularity</code> definition file in the repository instead of installing the Python module.</p>
<h4 id="Singularity:">Singularity:<a class="anchor-link" href="#Singularity:"> </a></h4><ul>
<li><p>This is a large image, you will need to set the following environment variables to somewhere other than <code>/tmp</code>:</p>
<ul>
<li><code>export SINGULARITY_TMPDIR={YOUR DESTINATION DIR}</code></li>
<li><code>export SINGULARITY_LOCALCACHEDIR={YOUR DESTINATION DIR}</code></li>
<li><code>export SINGULARITY_CACHEDIR={YOUR DESTINATION DIR}</code></li>
<li><code>export SINGULARITY_PULLFOLDER={YOUR DESTINATION DIR}</code></li>
</ul>
</li>
<li><p>Build the singularity image with the <code>singularity.def</code> file provided in Github, pulling from a base image often encounters inconsistent paths and binaries behavior. You  will need to have sudo permissions to perform singularity build.</p>
<ul>
<li><code>sudo singularity build {image_file_name}.sif singularity.def</code></li>
</ul>
</li>
<li><p>To run interactively or as a job execution, you will need a few flags:</p>
<ul>
<li><code>-e</code> for a clean environnment</li>
<li><code>-B</code> to bind your freesurfer license file to the image, as well as data/code directories.</li>
<li><code>singularity shell -e -B &lt;freesurfer_license_path&gt;:/license.txt -B &lt;BIDS_DIR&gt;:&lt;SINGULARITY_BIDS_DIR&gt; {Path to singularity .sif}</code></li>
<li>Once inside the singularity shell, confirm the license file is recognized as a environment variable. Or declare it with:<ul>
<li><code>export FS_LICENSE="/license.txt"</code></li>
</ul>
</li>
<li>Sometimes Freesurfer set-up doesn't run as container entry-point. <ul>
<li>Fix with <code>source /opt/freesurfer-7.1.0/SetUpFreeSurfer.sh</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p>Known container issues:</p>
<ul>
<li>Singularity image missing freesurfer's <code>nu_correct</code> and empty pearl binaries. </li>
</ul>
<h4 id="Creating-your-own-environment-and-install-pipetography-as-a-Python-module:">Creating your own environment and install <code>pipetography</code> as a Python module:<a class="anchor-link" href="#Creating-your-own-environment-and-install-pipetography-as-a-Python-module:"> </a></h4><p><code>pip install pipetography</code></p>
<p>Since <code>pipetography</code> is a <code>Nipype</code> wrapper around <code>mrtrix3</code>, <code>ANTs</code>, and <code>FSL</code>, you have to follow their installation instructions and set them up appropriately on your machine as well:</p>
<ul>
<li><p><a href="https://mrtrix.readthedocs.io/en/latest/installation/before_install.html">mrtrix3 v3.0.0</a></p>
</li>
<li><p><a href="https://github.com/ANTsX/ANTs/wiki/Compiling-ANTs-on-Linux-and-Mac-OS">ANTs</a></p>
</li>
<li><p><a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FslInstallation">FSL</a></p>
</li>
<li><p><a href="https://surfer.nmr.mgh.harvard.edu/fswiki/DownloadAndInstall">Freesurfer v7.1.0</a></p>
</li>
<li><p><a href="https://surfer.nmr.mgh.harvard.edu/fswiki/MatlabRuntime">Matlab Run Time Compiler for freesurfer</a></p>
</li>
</ul>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="The-pipeline:">The pipeline:<a class="anchor-link" href="#The-pipeline:"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Currently supports acquisitions with no reverse phase encoding (<code>-rpe_none</code>)  and reverse phase encoding in all DWI directions (<code>-rpe_all</code>) options.</p>

</div>
</div>
</div>
</div>
 

